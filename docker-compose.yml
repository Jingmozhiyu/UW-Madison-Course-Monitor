version: '3.8'

services:
  # æœåŠ¡ 1: ä½ çš„ Spring Boot åº”ç”¨
  course-sniper-app:
    build: .  # ä½¿ç”¨å½“å‰ç›®å½•çš„ Dockerfile æ„å»º
    ports:
      - "8080:8080" # å·¦è¾¹æ˜¯ Mac ç«¯å£ï¼Œå³è¾¹æ˜¯å®¹å™¨ç«¯å£
    depends_on:
      - mysqldb # å¿…é¡»ç­‰æ•°æ®åº“å¯åŠ¨äº†å†å¯åŠ¨æˆ‘
    environment:
      # ğŸ”¥ å…³é”®ç‚¹ï¼šè¦†ç›– application.properties é‡Œçš„é…ç½®
      # åœ¨ Docker å†…éƒ¨ï¼Œlocalhost æŒ‡çš„æ˜¯å®¹å™¨è‡ªå·±ã€‚
      # è¦è®¿é—®ä¸‹é¢çš„æ•°æ®åº“å®¹å™¨ï¼Œä¸»æœºåå¿…é¡»å†™æœåŠ¡å "mysqldb"
      SPRING_DATASOURCE_URL: jdbc:mysql://mysqldb:3306/course_monitor_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true&createDatabaseIfNotExist=true
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: root_password # å¯¹åº”ä¸‹é¢ DB çš„å¯†ç 
      SPRING_JPA_HIBERNATE_DDL_AUTO: update

  # æœåŠ¡ 2: MySQL æ•°æ®åº“
  mysqldb:
    image: mysql:8.0
    # å¦‚æœä½ æ˜¯ M1/M2/M3 èŠ¯ç‰‡ï¼ŒMySQL å®˜æ–¹é•œåƒå¯èƒ½æœ‰äº›æ…¢ï¼ŒåŠ ä¸Šè¿™è¡Œæ›´ç¨³
    platform: linux/x86_64
    ports:
      - "3307:3306" # æŠŠ Mac çš„ 3307 æ˜ å°„ç»™æ•°æ®åº“ï¼ˆé˜²æ­¢è·Ÿä½  Mac æœ¬åœ°çš„ MySQL 3306 å†²çªï¼‰
    environment:
      MYSQL_ROOT_PASSWORD: root_password
      MYSQL_DATABASE: course_monitor_db
    volumes:
      - db_data:/var/lib/mysql # æ•°æ®æŒä¹…åŒ–ï¼Œé˜²æ­¢é‡å¯ Docker æ•°æ®ä¸¢å¤±

volumes:
  db_data: